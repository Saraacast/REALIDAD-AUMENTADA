<!DOCTYPE html>
<html>

<head>
    <title>Clase AR - Erick Hansen</title>
    <!-- A-Frame 1.6.0 -->
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <!-- AR.js for A-Frame -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
    <script>
        AFRAME.registerComponent('toggle-color', {
            init: function () {
                console.log('Component toggle-color initialized');

                const handleModelLoaded = () => {
                    console.log('Model loaded - preparing materials');
                    const mesh = this.el.getObject3D('mesh');
                    if (mesh) {
                        this.originalMaterials = new Map();
                        mesh.traverse((node) => {
                            if (node.isMesh) {
                                this.originalMaterials.set(node, node.material.clone());
                            }
                        });
                        console.log('Materials saved');
                    }
                };

                // Check if model is already loaded
                if (this.el.getObject3D('mesh')) {
                    handleModelLoaded();
                } else {
                    this.el.addEventListener('model-loaded', handleModelLoaded);
                }

                this.isGray = false;

                this.el.addEventListener('click', (evt) => {
                    console.log('Click detected', evt);
                    const mesh = this.el.getObject3D('mesh');
                    if (!mesh) return;

                    this.isGray = !this.isGray;

                    mesh.traverse((node) => {
                        if (node.isMesh) {
                            if (this.isGray) {
                                node.material = new THREE.MeshStandardMaterial({
                                    color: 0x808080,
                                    metalness: 0.5,
                                    roughness: 0.5
                                });
                            } else {
                                if (this.originalMaterials && this.originalMaterials.has(node)) {
                                    node.material = this.originalMaterials.get(node);
                                }
                            }
                        }
                    });
                });
            }
        });
    </script>
    <a-scene embedded arjs cursor="rayOrigin: mouse" raycaster="objects: .clickable">

        <a-assets>
            <!-- Carga del modelo 3D (GLTF) -->
            <a-asset-item id="jerboa-model" src="jerboa_model/scene.gltf"></a-asset-item>
        </a-assets>

        <!-- Marcador Hiro -->
        <a-marker preset="hiro">

            <!-- Modelo 3D: Escala 2, RotaciÃ³n suave -->
            <a-entity gltf-model="#jerboa-model" scale="2 2 2" position="0 0 0"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear" class="clickable"
                toggle-color>
            </a-entity>

            <!-- Texto "Chinchilla" al lado -->
            <a-text value="Chinchilla" position="3 0 0" rotation="-90 -90 0" align="center" scale="3 3 3"
                color="#F44336">
            </a-text>



        </a-marker>

        <a-entity camera></a-entity>

    </a-scene>
</body>

</html>